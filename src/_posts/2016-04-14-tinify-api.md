---
title: 'Angular, Node, Amazon S3 and the Tinify API'
subhead: 'Optimize images and save them to the cloud'
---

My previous workflow for getting images web ready.

1. Open the image in Photoshop
2. Resize the image to reasonable dimensions
3. “Save for Web” as PNG
4. Optimize image using TinyPNG
5. Upload to Amazon S3.

*Phew.*

Does this sound familiar? Quite a process to follow for each of your image assets. Especially if the project is heavily image driven.
Allow me to propose a solution. A form where you can upload your assets, have them optimized at your preferred dimensions, then saved directly to Amazon S3.

#### Dependencies
- NodeJS v4+

#### Limitations
- Images must be under 5MB in size
- Only .jpg and .png file formats supported

#### Assumptions
- You’re familiar with both Angular and Express.

Prefer to skip the tutorial? No problem, click [here](https://github.com/yjimk/angular-tinify-s3) for the source code.

#### Used in this project
- AngularJS
- NodeJS
- ExpressJS
- Tinify by TinyPNG
- Angular File Upload by nervgh

#### What is Tinify by TinyPNG?
Haven’t used TinyPNG before? It’s a great online tool for web optimizing PNG or JPG images under 5MB in size.
“But, hang on, I can do that in Photoshop right?”
Yeah, sure you can. The difference is that TinyPNG does it better. As a small example, take my logo for instance.
Using Photoshop "Save for Web" - 5.7KB

![photoshop](/img/tinify-api/jc1.png)

Now with TinyPNG API - 2.4KB

![photoshop](/img/tinify-api/jc2.png)

Over a 50% reduction in this instance. Plus on the upshot, the TinyPNG API is free for the first 500 optimized images.
In newer versions of Photoshop, "Save for Web" has been deprecated in favour of "Export", however I have found that the TinyPNG algorithm still comes out ahead.
So, first step. Let’s head over to the TinyPNG website and sign up for an API key. https://tinypng.com/developers

With that done, let’s install our modules.

<div id="gist33681187" class="gist">    <div class="gist-file">      <div class="gist-data">        <div class="js-gist-file-update-container js-task-list-container file-box">  <div id="file-setup-sh" class="file">      <div itemprop="text" class="blob-wrapper data type-shell">      <table class="highlight tab-size js-file-line-container" data-tab-size="8">      <tr>        <td id="file-setup-sh-L1" class="blob-num js-line-number" data-line-number="1"></td>        <td id="file-setup-sh-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#!</span>/bin/bash</span></td>      </tr>      <tr>        <td id="file-setup-sh-L2" class="blob-num js-line-number" data-line-number="2"></td>        <td id="file-setup-sh-LC2" class="blob-code blob-code-inner js-file-line">mkdir angular-tinify-s3</td>      </tr>      <tr>        <td id="file-setup-sh-L3" class="blob-num js-line-number" data-line-number="3"></td>        <td id="file-setup-sh-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">cd</span> angular-tinify-s3</td>      </tr>      <tr>        <td id="file-setup-sh-L4" class="blob-num js-line-number" data-line-number="4"></td>        <td id="file-setup-sh-LC4" class="blob-code blob-code-inner js-file-line">npm init -y</td>      </tr>      <tr>        <td id="file-setup-sh-L5" class="blob-num js-line-number" data-line-number="5"></td>        <td id="file-setup-sh-LC5" class="blob-code blob-code-inner js-file-line">npm i -S express</td>      </tr>      <tr>        <td id="file-setup-sh-L6" class="blob-num js-line-number" data-line-number="6"></td>        <td id="file-setup-sh-LC6" class="blob-code blob-code-inner js-file-line">npm i -S body-parser</td>      </tr>      <tr>        <td id="file-setup-sh-L7" class="blob-num js-line-number" data-line-number="7"></td>        <td id="file-setup-sh-LC7" class="blob-code blob-code-inner js-file-line">npm i -S method-override</td>      </tr>      <tr>        <td id="file-setup-sh-L8" class="blob-num js-line-number" data-line-number="8"></td>        <td id="file-setup-sh-LC8" class="blob-code blob-code-inner js-file-line">npm i -S morgan</td>      </tr>      <tr>        <td id="file-setup-sh-L9" class="blob-num js-line-number" data-line-number="9"></td>        <td id="file-setup-sh-LC9" class="blob-code blob-code-inner js-file-line">npm i -S multer</td>      </tr>      <tr>        <td id="file-setup-sh-L10" class="blob-num js-line-number" data-line-number="10"></td>        <td id="file-setup-sh-LC10" class="blob-code blob-code-inner js-file-line">npm i -S tinify</td>      </tr>      <tr>        <td id="file-setup-sh-L11" class="blob-num js-line-number" data-line-number="11"></td>        <td id="file-setup-sh-LC11" class="blob-code blob-code-inner js-file-line">npm i -D nodemon</td>      </tr>      <tr>        <td id="file-setup-sh-L12" class="blob-num js-line-number" data-line-number="12"></td>        <td id="file-setup-sh-LC12" class="blob-code blob-code-inner js-file-line">npm i -D bower</td>      </tr>      <tr>        <td id="file-setup-sh-L13" class="blob-num js-line-number" data-line-number="13"></td>        <td id="file-setup-sh-LC13" class="blob-code blob-code-inner js-file-line">mkdir public</td>      </tr>      <tr>        <td id="file-setup-sh-L14" class="blob-num js-line-number" data-line-number="14"></td>        <td id="file-setup-sh-LC14" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">cd</span> public</td>      </tr>      <tr>        <td id="file-setup-sh-L15" class="blob-num js-line-number" data-line-number="15"></td>        <td id="file-setup-sh-LC15" class="blob-code blob-code-inner js-file-line">bower i -S angular-ui-router</td>      </tr>      <tr>        <td id="file-setup-sh-L16" class="blob-num js-line-number" data-line-number="16"></td>        <td id="file-setup-sh-LC16" class="blob-code blob-code-inner js-file-line">bower i -S angular-sanitize</td>      </tr>      <tr>        <td id="file-setup-sh-L17" class="blob-num js-line-number" data-line-number="17"></td>        <td id="file-setup-sh-LC17" class="blob-code blob-code-inner js-file-line">bower i -S ng-file-upload</td>      </tr></table>  </div>  </div>  </div>      </div>      <div class="gist-meta">        <a href="https://gist.github.com/yjimk/5e4e7d0a8305754d115fce40f44878c7/raw/0743fba9fa7870722dab29f5e20effda410b27d3/setup.sh" style="float:right">view raw</a>        <a href="https://gist.github.com/yjimk/5e4e7d0a8305754d115fce40f44878c7#file-setup-sh">setup.sh</a>        hosted with &#10084; by <a href="https://github.com">GitHub</a>      </div>    </div></div>

Next up, a very simple Express server

<div id="gist33681380" class="gist">    <div class="gist-file">      <div class="gist-data">        <div class="js-gist-file-update-container js-task-list-container file-box">  <div id="file-server-js" class="file">      <div itemprop="text" class="blob-wrapper data type-javascript">      <table class="highlight tab-size js-file-line-container" data-tab-size="8">      <tr>        <td id="file-server-js-L1" class="blob-num js-line-number" data-line-number="1"></td>        <td id="file-server-js-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> modules =================================================</span></td>      </tr>      <tr>        <td id="file-server-js-L2" class="blob-num js-line-number" data-line-number="2"></td>        <td id="file-server-js-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-k">var</span> express         <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>express<span class="pl-pds">&#39;</span></span>);</td>      </tr>      <tr>        <td id="file-server-js-L3" class="blob-num js-line-number" data-line-number="3"></td>        <td id="file-server-js-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-k">var</span> app             <span class="pl-k">=</span> <span class="pl-en">express</span>();</td>      </tr>      <tr>        <td id="file-server-js-L4" class="blob-num js-line-number" data-line-number="4"></td>        <td id="file-server-js-LC4" class="blob-code blob-code-inner js-file-line"><span class="pl-k">var</span> router          <span class="pl-k">=</span> <span class="pl-smi">express</span>.<span class="pl-en">Router</span>();</td>      </tr>      <tr>        <td id="file-server-js-L5" class="blob-num js-line-number" data-line-number="5"></td>        <td id="file-server-js-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-k">var</span> bodyParser      <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>body-parser<span class="pl-pds">&#39;</span></span>);</td>      </tr>      <tr>        <td id="file-server-js-L6" class="blob-num js-line-number" data-line-number="6"></td>        <td id="file-server-js-LC6" class="blob-code blob-code-inner js-file-line"><span class="pl-k">var</span> morgan          <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>morgan<span class="pl-pds">&#39;</span></span>);</td>      </tr>      <tr>        <td id="file-server-js-L7" class="blob-num js-line-number" data-line-number="7"></td>        <td id="file-server-js-LC7" class="blob-code blob-code-inner js-file-line"><span class="pl-k">var</span> methodOverride  <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>method-override<span class="pl-pds">&#39;</span></span>);</td>      </tr>      <tr>        <td id="file-server-js-L8" class="blob-num js-line-number" data-line-number="8"></td>        <td id="file-server-js-LC8" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-server-js-L9" class="blob-num js-line-number" data-line-number="9"></td>        <td id="file-server-js-LC9" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> configuration ===========================================</span></td>      </tr>      <tr>        <td id="file-server-js-L10" class="blob-num js-line-number" data-line-number="10"></td>        <td id="file-server-js-LC10" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-server-js-L11" class="blob-num js-line-number" data-line-number="11"></td>        <td id="file-server-js-LC11" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> set our port</span></td>      </tr>      <tr>        <td id="file-server-js-L12" class="blob-num js-line-number" data-line-number="12"></td>        <td id="file-server-js-LC12" class="blob-code blob-code-inner js-file-line"><span class="pl-k">var</span> port <span class="pl-k">=</span> <span class="pl-c1">process</span>.<span class="pl-smi">env</span>.<span class="pl-c1">PORT</span> <span class="pl-k">||</span> <span class="pl-c1">3000</span>;</td>      </tr>      <tr>        <td id="file-server-js-L13" class="blob-num js-line-number" data-line-number="13"></td>        <td id="file-server-js-LC13" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-server-js-L14" class="blob-num js-line-number" data-line-number="14"></td>        <td id="file-server-js-LC14" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-en">morgan</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>dev<span class="pl-pds">&#39;</span></span>));</td>      </tr>      <tr>        <td id="file-server-js-L15" class="blob-num js-line-number" data-line-number="15"></td>        <td id="file-server-js-LC15" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-server-js-L16" class="blob-num js-line-number" data-line-number="16"></td>        <td id="file-server-js-LC16" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> get all data/stuff of the body (POST) parameters</span></td>      </tr>      <tr>        <td id="file-server-js-L17" class="blob-num js-line-number" data-line-number="17"></td>        <td id="file-server-js-LC17" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> parse application/json</span></td>      </tr>      <tr>        <td id="file-server-js-L18" class="blob-num js-line-number" data-line-number="18"></td>        <td id="file-server-js-LC18" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-smi">bodyParser</span>.<span class="pl-en">json</span>());</td>      </tr>      <tr>        <td id="file-server-js-L19" class="blob-num js-line-number" data-line-number="19"></td>        <td id="file-server-js-LC19" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-smi">bodyParser</span>.<span class="pl-en">urlencoded</span>({ extended<span class="pl-k">:</span> <span class="pl-c1">true</span> }));</td>      </tr>      <tr>        <td id="file-server-js-L20" class="blob-num js-line-number" data-line-number="20"></td>        <td id="file-server-js-LC20" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-server-js-L21" class="blob-num js-line-number" data-line-number="21"></td>        <td id="file-server-js-LC21" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> override with the X-HTTP-Method-Override header in the request. simulate DELETE/PUT</span></td>      </tr>      <tr>        <td id="file-server-js-L22" class="blob-num js-line-number" data-line-number="22"></td>        <td id="file-server-js-LC22" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-en">methodOverride</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>X-HTTP-Method-Override<span class="pl-pds">&#39;</span></span>));</td>      </tr>      <tr>        <td id="file-server-js-L23" class="blob-num js-line-number" data-line-number="23"></td>        <td id="file-server-js-LC23" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-server-js-L24" class="blob-num js-line-number" data-line-number="24"></td>        <td id="file-server-js-LC24" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> set the static files location</span></td>      </tr>      <tr>        <td id="file-server-js-L25" class="blob-num js-line-number" data-line-number="25"></td>        <td id="file-server-js-LC25" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-smi">express</span>.<span class="pl-en">static</span>(<span class="pl-c1">__dirname</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&#39;</span>/public<span class="pl-pds">&#39;</span></span>));</td>      </tr>      <tr>        <td id="file-server-js-L26" class="blob-num js-line-number" data-line-number="26"></td>        <td id="file-server-js-LC26" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-server-js-L27" class="blob-num js-line-number" data-line-number="27"></td>        <td id="file-server-js-LC27" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-k">function</span>(<span class="pl-smi">req</span>, <span class="pl-smi">res</span>, <span class="pl-smi">next</span>) {</td>      </tr>      <tr>        <td id="file-server-js-L28" class="blob-num js-line-number" data-line-number="28"></td>        <td id="file-server-js-LC28" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">res</span>.<span class="pl-en">header</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>Access-Control-Allow-Origin<span class="pl-pds">&quot;</span></span>, <span class="pl-s"><span class="pl-pds">&quot;</span>*<span class="pl-pds">&quot;</span></span>);</td>      </tr>      <tr>        <td id="file-server-js-L29" class="blob-num js-line-number" data-line-number="29"></td>        <td id="file-server-js-LC29" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">res</span>.<span class="pl-en">header</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>Access-Control-Allow-Headers<span class="pl-pds">&quot;</span></span>, <span class="pl-s"><span class="pl-pds">&quot;</span>Content-Type<span class="pl-pds">&quot;</span></span>);</td>      </tr>      <tr>        <td id="file-server-js-L30" class="blob-num js-line-number" data-line-number="30"></td>        <td id="file-server-js-LC30" class="blob-code blob-code-inner js-file-line">    <span class="pl-en">next</span>();</td>      </tr>      <tr>        <td id="file-server-js-L31" class="blob-num js-line-number" data-line-number="31"></td>        <td id="file-server-js-LC31" class="blob-code blob-code-inner js-file-line">});</td>      </tr>      <tr>        <td id="file-server-js-L32" class="blob-num js-line-number" data-line-number="32"></td>        <td id="file-server-js-LC32" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-server-js-L33" class="blob-num js-line-number" data-line-number="33"></td>        <td id="file-server-js-LC33" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> routes</span></td>      </tr>      <tr>        <td id="file-server-js-L34" class="blob-num js-line-number" data-line-number="34"></td>        <td id="file-server-js-LC34" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>./app/routes.js<span class="pl-pds">&#39;</span></span>)(app);</td>      </tr>      <tr>        <td id="file-server-js-L35" class="blob-num js-line-number" data-line-number="35"></td>        <td id="file-server-js-LC35" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-server-js-L36" class="blob-num js-line-number" data-line-number="36"></td>        <td id="file-server-js-LC36" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">router</span>.<span class="pl-c1">get</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>*<span class="pl-pds">&#39;</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">res</span>) {</td>      </tr>      <tr>        <td id="file-server-js-L37" class="blob-num js-line-number" data-line-number="37"></td>        <td id="file-server-js-LC37" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">res</span>.<span class="pl-en">sendFile</span>(<span class="pl-c1">__dirname</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&#39;</span>/public/index.html<span class="pl-pds">&#39;</span></span>); <span class="pl-c"><span class="pl-c">//</span> load the single view file (angular will handle the page changes on the front-end)</span></td>      </tr>      <tr>        <td id="file-server-js-L38" class="blob-num js-line-number" data-line-number="38"></td>        <td id="file-server-js-LC38" class="blob-code blob-code-inner js-file-line">});</td>      </tr>      <tr>        <td id="file-server-js-L39" class="blob-num js-line-number" data-line-number="39"></td>        <td id="file-server-js-LC39" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>/<span class="pl-pds">&#39;</span></span>,router);</td>      </tr>      <tr>        <td id="file-server-js-L40" class="blob-num js-line-number" data-line-number="40"></td>        <td id="file-server-js-LC40" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-server-js-L41" class="blob-num js-line-number" data-line-number="41"></td>        <td id="file-server-js-LC41" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> startup our app at http://localhost:3000</span></td>      </tr>      <tr>        <td id="file-server-js-L42" class="blob-num js-line-number" data-line-number="42"></td>        <td id="file-server-js-LC42" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">app</span>.<span class="pl-en">listen</span>(port);</td>      </tr>      <tr>        <td id="file-server-js-L43" class="blob-num js-line-number" data-line-number="43"></td>        <td id="file-server-js-LC43" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-server-js-L44" class="blob-num js-line-number" data-line-number="44"></td>        <td id="file-server-js-LC44" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> shoutout to the user</span></td>      </tr>      <tr>        <td id="file-server-js-L45" class="blob-num js-line-number" data-line-number="45"></td>        <td id="file-server-js-LC45" class="blob-code blob-code-inner js-file-line"><span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>Now available at localhost:<span class="pl-pds">&#39;</span></span> <span class="pl-k">+</span> port);</td>      </tr>      <tr>        <td id="file-server-js-L46" class="blob-num js-line-number" data-line-number="46"></td>        <td id="file-server-js-LC46" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-server-js-L47" class="blob-num js-line-number" data-line-number="47"></td>        <td id="file-server-js-LC47" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> expose app</span></td>      </tr>      <tr>        <td id="file-server-js-L48" class="blob-num js-line-number" data-line-number="48"></td>        <td id="file-server-js-LC48" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">exports</span> <span class="pl-k">=</span> <span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> app;</td>      </tr></table>  </div>  </div>  </div>      </div>      <div class="gist-meta">        <a href="https://gist.github.com/yjimk/3176cc3892af04c7a1ddd4642206e84c/raw/0e9c3a69ff817bfd23723d3a13b96632f55a1464/server.js" style="float:right">view raw</a>        <a href="https://gist.github.com/yjimk/3176cc3892af04c7a1ddd4642206e84c#file-server-js">server.js</a>        hosted with &#10084; by <a href="https://github.com">GitHub</a>      </div>    </div></div>

So we can’t quite run our server yet, Express will complain that we’re missing a couple of files.

```bash
mkdir app
cd app
touch routes.js
cd ../public
touch index.html
```

That’ll be enough to start our server at least. Change directory back to project root and run:

```bash
nodemon server.js
```

Awesome, we’re up and running on localhost:3000, albeit with a blank page.
As a side note, I’m using Nodemon here to automatically reload our server when we make changes. It can be quite annoying stopping and starting the server every time otherwise. Here’s a config file you can place in the root so it doesn’t reload when you’re only changing the front end.

<div id="gist33682359" class="gist">    <div class="gist-file">      <div class="gist-data">        <div class="js-gist-file-update-container js-task-list-container file-box">  <div id="file-nodemon-json" class="file">      <div itemprop="text" class="blob-wrapper data type-json">      <table class="highlight tab-size js-file-line-container" data-tab-size="8">      <tr>        <td id="file-nodemon-json-L1" class="blob-num js-line-number" data-line-number="1"></td>        <td id="file-nodemon-json-LC1" class="blob-code blob-code-inner js-file-line">{</td>      </tr>      <tr>        <td id="file-nodemon-json-L2" class="blob-num js-line-number" data-line-number="2"></td>        <td id="file-nodemon-json-LC2" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">&quot;</span>verbose<span class="pl-pds">&quot;</span></span>: <span class="pl-c1">true</span>,</td>      </tr>      <tr>        <td id="file-nodemon-json-L3" class="blob-num js-line-number" data-line-number="3"></td>        <td id="file-nodemon-json-LC3" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">&quot;</span>ignore<span class="pl-pds">&quot;</span></span>: [<span class="pl-s"><span class="pl-pds">&quot;</span>public/*<span class="pl-pds">&quot;</span></span>,<span class="pl-s"><span class="pl-pds">&quot;</span>app/uploads/*<span class="pl-pds">&quot;</span></span>]</td>      </tr>      <tr>        <td id="file-nodemon-json-L4" class="blob-num js-line-number" data-line-number="4"></td>        <td id="file-nodemon-json-LC4" class="blob-code blob-code-inner js-file-line">}</td>      </tr></table>  </div>  </div>  </div>      </div>      <div class="gist-meta">        <a href="https://gist.github.com/yjimk/2be888e26f9d0559d158029acc9ef3c2/raw/20718c5eb5e6af65af6c1c8d8f817de2644e57be/nodemon.json" style="float:right">view raw</a>        <a href="https://gist.github.com/yjimk/2be888e26f9d0559d158029acc9ef3c2#file-nodemon-json">nodemon.json</a>        hosted with &#10084; by <a href="https://github.com">GitHub</a>      </div>    </div></div>

Only a little bit more before we get to the meat, just need to set up a basic front end with Angular.
For brevity I have left out the head section of this gist.

`/public/index.html`

<div id="gist33682117" class="gist">    <div class="gist-file">      <div class="gist-data">        <div class="js-gist-file-update-container js-task-list-container file-box">  <div id="file-index-html" class="file">      <div itemprop="text" class="blob-wrapper data type-html">      <table class="highlight tab-size js-file-line-container" data-tab-size="8">      <tr>        <td id="file-index-html-L1" class="blob-num js-line-number" data-line-number="1"></td>        <td id="file-index-html-LC1" class="blob-code blob-code-inner js-file-line">&lt;<span class="pl-ent">body</span> <span class="pl-e">ng-app</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>angular-tinify-s3<span class="pl-pds">&quot;</span></span>&gt;</td>      </tr>      <tr>        <td id="file-index-html-L2" class="blob-num js-line-number" data-line-number="2"></td>        <td id="file-index-html-LC2" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-index-html-L3" class="blob-num js-line-number" data-line-number="3"></td>        <td id="file-index-html-LC3" class="blob-code blob-code-inner js-file-line">    &lt;<span class="pl-ent">div</span> <span class="pl-e">ui-view</span> <span class="pl-e">ng-cloak</span>&gt;&lt;/<span class="pl-ent">div</span>&gt;</td>      </tr>      <tr>        <td id="file-index-html-L4" class="blob-num js-line-number" data-line-number="4"></td>        <td id="file-index-html-LC4" class="blob-code blob-code-inner js-file-line">    </td>      </tr>      <tr>        <td id="file-index-html-L5" class="blob-num js-line-number" data-line-number="5"></td>        <td id="file-index-html-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-s1">    &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>bower_components/angular/angular.min.js<span class="pl-pds">&quot;</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</span></td>      </tr>      <tr>        <td id="file-index-html-L6" class="blob-num js-line-number" data-line-number="6"></td>        <td id="file-index-html-LC6" class="blob-code blob-code-inner js-file-line"><span class="pl-s1">    &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>bower_components/angular-ui-router/release/angular-ui-router.min.js<span class="pl-pds">&quot;</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</span></td>      </tr>      <tr>        <td id="file-index-html-L7" class="blob-num js-line-number" data-line-number="7"></td>        <td id="file-index-html-LC7" class="blob-code blob-code-inner js-file-line"><span class="pl-s1">    &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>bower_components/angular-sanitize/angular-sanitize.min.js<span class="pl-pds">&quot;</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</span></td>      </tr>      <tr>        <td id="file-index-html-L8" class="blob-num js-line-number" data-line-number="8"></td>        <td id="file-index-html-LC8" class="blob-code blob-code-inner js-file-line"><span class="pl-s1">    &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>bower_components/ng-file-upload/ng-file-upload.min.js<span class="pl-pds">&quot;</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</span></td>      </tr>      <tr>        <td id="file-index-html-L9" class="blob-num js-line-number" data-line-number="9"></td>        <td id="file-index-html-LC9" class="blob-code blob-code-inner js-file-line"><span class="pl-s1">    &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>js/app.js<span class="pl-pds">&quot;</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</span></td>      </tr>      <tr>        <td id="file-index-html-L10" class="blob-num js-line-number" data-line-number="10"></td>        <td id="file-index-html-LC10" class="blob-code blob-code-inner js-file-line"><span class="pl-s1">    &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>js/controller/upload-controller.js<span class="pl-pds">&quot;</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</span></td>      </tr>      <tr>        <td id="file-index-html-L11" class="blob-num js-line-number" data-line-number="11"></td>        <td id="file-index-html-LC11" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-index-html-L12" class="blob-num js-line-number" data-line-number="12"></td>        <td id="file-index-html-LC12" class="blob-code blob-code-inner js-file-line">&lt;/<span class="pl-ent">body</span>&gt;</td>      </tr></table>  </div>  </div>  </div>      </div>      <div class="gist-meta">        <a href="https://gist.github.com/yjimk/ab5514c8c973e70c5cf978b1ab59e9c2/raw/9e9e98f3547330e3b8b4a2a9de3f36803a743887/index.html" style="float:right">view raw</a>        <a href="https://gist.github.com/yjimk/ab5514c8c973e70c5cf978b1ab59e9c2#file-index-html">index.html</a>        hosted with &#10084; by <a href="https://github.com">GitHub</a>      </div>    </div></div>

`/public/js/app.js`

<div id="gist33682161" class="gist">    <div class="gist-file">      <div class="gist-data">        <div class="js-gist-file-update-container js-task-list-container file-box">  <div id="file-app-js" class="file">      <div itemprop="text" class="blob-wrapper data type-javascript">      <table class="highlight tab-size js-file-line-container" data-tab-size="8">      <tr>        <td id="file-app-js-L1" class="blob-num js-line-number" data-line-number="1"></td>        <td id="file-app-js-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-s"><span class="pl-pds">&#39;</span>use strict<span class="pl-pds">&#39;</span></span>;</td>      </tr>      <tr>        <td id="file-app-js-L2" class="blob-num js-line-number" data-line-number="2"></td>        <td id="file-app-js-LC2" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-app-js-L3" class="blob-num js-line-number" data-line-number="3"></td>        <td id="file-app-js-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">angular</span>.<span class="pl-en">module</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>angular-tinify-s3<span class="pl-pds">&#39;</span></span>, [</td>      </tr>      <tr>        <td id="file-app-js-L4" class="blob-num js-line-number" data-line-number="4"></td>        <td id="file-app-js-LC4" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">&#39;</span>ui.router<span class="pl-pds">&#39;</span></span>, <span class="pl-s"><span class="pl-pds">&#39;</span>ngFileUpload<span class="pl-pds">&#39;</span></span>, <span class="pl-s"><span class="pl-pds">&#39;</span>ngSanitize<span class="pl-pds">&#39;</span></span></td>      </tr>      <tr>        <td id="file-app-js-L5" class="blob-num js-line-number" data-line-number="5"></td>        <td id="file-app-js-LC5" class="blob-code blob-code-inner js-file-line">]).<span class="pl-en">config</span>(<span class="pl-k">function</span>(<span class="pl-smi">$stateProvider</span>, <span class="pl-smi">$urlRouterProvider</span>, <span class="pl-smi">$locationProvider</span>) {</td>      </tr>      <tr>        <td id="file-app-js-L6" class="blob-num js-line-number" data-line-number="6"></td>        <td id="file-app-js-LC6" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">$urlRouterProvider</span>.<span class="pl-en">otherwise</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>/<span class="pl-pds">&#39;</span></span>);</td>      </tr>      <tr>        <td id="file-app-js-L7" class="blob-num js-line-number" data-line-number="7"></td>        <td id="file-app-js-LC7" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-app-js-L8" class="blob-num js-line-number" data-line-number="8"></td>        <td id="file-app-js-LC8" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">$stateProvider</span>.<span class="pl-en">state</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>base<span class="pl-pds">&#39;</span></span>, {</td>      </tr>      <tr>        <td id="file-app-js-L9" class="blob-num js-line-number" data-line-number="9"></td>        <td id="file-app-js-LC9" class="blob-code blob-code-inner js-file-line">        url<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&#39;</span>/<span class="pl-pds">&#39;</span></span>,</td>      </tr>      <tr>        <td id="file-app-js-L10" class="blob-num js-line-number" data-line-number="10"></td>        <td id="file-app-js-LC10" class="blob-code blob-code-inner js-file-line">        templateUrl<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&#39;</span>view/upload.html<span class="pl-pds">&#39;</span></span>,</td>      </tr>      <tr>        <td id="file-app-js-L11" class="blob-num js-line-number" data-line-number="11"></td>        <td id="file-app-js-LC11" class="blob-code blob-code-inner js-file-line">        controller<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&#39;</span>uploadCtrl<span class="pl-pds">&#39;</span></span></td>      </tr>      <tr>        <td id="file-app-js-L12" class="blob-num js-line-number" data-line-number="12"></td>        <td id="file-app-js-LC12" class="blob-code blob-code-inner js-file-line">    });</td>      </tr>      <tr>        <td id="file-app-js-L13" class="blob-num js-line-number" data-line-number="13"></td>        <td id="file-app-js-LC13" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">$locationProvider</span>.<span class="pl-en">html5Mode</span>(<span class="pl-c1">true</span>);</td>      </tr>      <tr>        <td id="file-app-js-L14" class="blob-num js-line-number" data-line-number="14"></td>        <td id="file-app-js-LC14" class="blob-code blob-code-inner js-file-line">});</td>      </tr></table>  </div>  </div>  </div>      </div>      <div class="gist-meta">        <a href="https://gist.github.com/yjimk/31a3b95c594e147fde4f689cb71ad4fd/raw/7d6f9f9472d542def369eb48350b32991b17292b/app.js" style="float:right">view raw</a>        <a href="https://gist.github.com/yjimk/31a3b95c594e147fde4f689cb71ad4fd#file-app-js">app.js</a>        hosted with &#10084; by <a href="https://github.com">GitHub</a>      </div>    </div></div>

We’ll add more to the controller later, but for the moment it’ll be blank with the ‘Upload’ module injected.

`/public/js/controller/upload-controller.js`

<div id="gist33682193" class="gist">    <div class="gist-file">      <div class="gist-data">        <div class="js-gist-file-update-container js-task-list-container file-box">  <div id="file-upload-controller-js" class="file">      <div itemprop="text" class="blob-wrapper data type-javascript">      <table class="highlight tab-size js-file-line-container" data-tab-size="8">      <tr>        <td id="file-upload-controller-js-L1" class="blob-num js-line-number" data-line-number="1"></td>        <td id="file-upload-controller-js-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">angular</span>.<span class="pl-en">module</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>angular-tinify-s3<span class="pl-pds">&#39;</span></span>).<span class="pl-en">controller</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>uploadCtrl<span class="pl-pds">&#39;</span></span>,[<span class="pl-s"><span class="pl-pds">&#39;</span>$scope<span class="pl-pds">&#39;</span></span>, <span class="pl-s"><span class="pl-pds">&#39;</span>$window<span class="pl-pds">&#39;</span></span>, <span class="pl-s"><span class="pl-pds">&#39;</span>Upload<span class="pl-pds">&#39;</span></span>, </td>      </tr>      <tr>        <td id="file-upload-controller-js-L2" class="blob-num js-line-number" data-line-number="2"></td>        <td id="file-upload-controller-js-LC2" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">function</span>(<span class="pl-smi">$scope</span>, <span class="pl-smi">$window</span>, <span class="pl-smi">Upload</span>){</td>      </tr>      <tr>        <td id="file-upload-controller-js-L3" class="blob-num js-line-number" data-line-number="3"></td>        <td id="file-upload-controller-js-LC3" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-upload-controller-js-L4" class="blob-num js-line-number" data-line-number="4"></td>        <td id="file-upload-controller-js-LC4" class="blob-code blob-code-inner js-file-line">}]);</td>      </tr></table>  </div>  </div>  </div>      </div>      <div class="gist-meta">        <a href="https://gist.github.com/yjimk/8c905989fff8308b8f9d92e7efdab4c4/raw/ebd2f1bcb3f058184da5d4ab34421e9b9e374c7c/upload-controller.js" style="float:right">view raw</a>        <a href="https://gist.github.com/yjimk/8c905989fff8308b8f9d92e7efdab4c4#file-upload-controller-js">upload-controller.js</a>        hosted with &#10084; by <a href="https://github.com">GitHub</a>      </div>    </div></div>

Now, let’s put together our view.
```bash
cd public
mkdir view
touch upload.html
```

To get our file from our local machine to the end of the process, we’ll need a way to upload our images and a way to accept the parameters used with the Tinify API.
For file upload we will use none other than Angular File Upload. In my opinion it is the best one out there for Angular at the moment. Please check out their documentation here (LINK), there is a lot more you can do with this (including a really slick drag and drop), than I’ll be covering in this guide.
The Tinify API will take three parameters when handling your image; height, width and method. The method refers to the three types that your image can be processed; scale, fit and cover. More detail about method can be found here (LINK), but to paraphrase
- Fit: Scales image to exactly the dimensions specified (stretching may occur)
- Cover: Scales and intelligently crops to your set dimensions
- Scale: Takes a width or height value and scales appropriately. Either height or width must be set to 0 for this to work.

`public/view/upload.html`

<div id="gist33685437" class="gist">    <div class="gist-file">      <div class="gist-data">        <div class="js-gist-file-update-container js-task-list-container file-box">  <div id="file-upload-html" class="file">      <div itemprop="text" class="blob-wrapper data type-html">      <table class="highlight tab-size js-file-line-container" data-tab-size="8">      <tr>        <td id="file-upload-html-L1" class="blob-num js-line-number" data-line-number="1"></td>        <td id="file-upload-html-LC1" class="blob-code blob-code-inner js-file-line">&lt;<span class="pl-ent">div</span> <span class="pl-e">ng-controller</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>uploadCtrl as up<span class="pl-pds">&quot;</span></span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L2" class="blob-num js-line-number" data-line-number="2"></td>        <td id="file-upload-html-LC2" class="blob-code blob-code-inner js-file-line">    &lt;<span class="pl-ent">h3</span>&gt;Angular Tinify S3&lt;/<span class="pl-ent">h3</span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L3" class="blob-num js-line-number" data-line-number="3"></td>        <td id="file-upload-html-LC3" class="blob-code blob-code-inner js-file-line">    &lt;<span class="pl-ent">form</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>up.upload_form<span class="pl-pds">&quot;</span></span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L4" class="blob-num js-line-number" data-line-number="4"></td>        <td id="file-upload-html-LC4" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">&lt;!--</span> For Angular File Upload <span class="pl-c">--&gt;</span></span></td>      </tr>      <tr>        <td id="file-upload-html-L5" class="blob-num js-line-number" data-line-number="5"></td>        <td id="file-upload-html-LC5" class="blob-code blob-code-inner js-file-line">        &lt;<span class="pl-ent">input</span></td>      </tr>      <tr>        <td id="file-upload-html-L6" class="blob-num js-line-number" data-line-number="6"></td>        <td id="file-upload-html-LC6" class="blob-code blob-code-inner js-file-line">                <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>file<span class="pl-pds">&quot;</span></span></td>      </tr>      <tr>        <td id="file-upload-html-L7" class="blob-num js-line-number" data-line-number="7"></td>        <td id="file-upload-html-LC7" class="blob-code blob-code-inner js-file-line">                <span class="pl-e">ngf-select</span></td>      </tr>      <tr>        <td id="file-upload-html-L8" class="blob-num js-line-number" data-line-number="8"></td>        <td id="file-upload-html-LC8" class="blob-code blob-code-inner js-file-line">                <span class="pl-e">ng-model</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>up.file<span class="pl-pds">&quot;</span></span></td>      </tr>      <tr>        <td id="file-upload-html-L9" class="blob-num js-line-number" data-line-number="9"></td>        <td id="file-upload-html-LC9" class="blob-code blob-code-inner js-file-line">                <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>file<span class="pl-pds">&quot;</span></span></td>      </tr>      <tr>        <td id="file-upload-html-L10" class="blob-num js-line-number" data-line-number="10"></td>        <td id="file-upload-html-LC10" class="blob-code blob-code-inner js-file-line">                <span class="pl-e">ngf-pattern</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>&#39;image/*&#39;<span class="pl-pds">&quot;</span></span></td>      </tr>      <tr>        <td id="file-upload-html-L11" class="blob-num js-line-number" data-line-number="11"></td>        <td id="file-upload-html-LC11" class="blob-code blob-code-inner js-file-line">                <span class="pl-e">accept</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>image/*<span class="pl-pds">&quot;</span></span></td>      </tr>      <tr>        <td id="file-upload-html-L12" class="blob-num js-line-number" data-line-number="12"></td>        <td id="file-upload-html-LC12" class="blob-code blob-code-inner js-file-line">                <span class="pl-e">ngf-max-size</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>5MB<span class="pl-pds">&quot;</span></span></td>      </tr>      <tr>        <td id="file-upload-html-L13" class="blob-num js-line-number" data-line-number="13"></td>        <td id="file-upload-html-LC13" class="blob-code blob-code-inner js-file-line">        /&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L14" class="blob-num js-line-number" data-line-number="14"></td>        <td id="file-upload-html-LC14" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-upload-html-L15" class="blob-num js-line-number" data-line-number="15"></td>        <td id="file-upload-html-LC15" class="blob-code blob-code-inner js-file-line">        &lt;<span class="pl-ent">i</span> <span class="pl-e">ng-show</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>up.upload_form.file.$error.required<span class="pl-pds">&quot;</span></span>&gt;*required&lt;/<span class="pl-ent">i</span>&gt;&lt;<span class="pl-ent">br</span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L16" class="blob-num js-line-number" data-line-number="16"></td>        <td id="file-upload-html-LC16" class="blob-code blob-code-inner js-file-line">        &lt;<span class="pl-ent">i</span> <span class="pl-e">ng-show</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>up.upload_form.file.$error.maxSize<span class="pl-pds">&quot;</span></span>&gt;File too large</td>      </tr>      <tr>        <td id="file-upload-html-L17" class="blob-num js-line-number" data-line-number="17"></td>        <td id="file-upload-html-LC17" class="blob-code blob-code-inner js-file-line">            {{up.file.size / 1000000|number:1}}MB: max 5MB&lt;/<span class="pl-ent">i</span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L18" class="blob-num js-line-number" data-line-number="18"></td>        <td id="file-upload-html-LC18" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-upload-html-L19" class="blob-num js-line-number" data-line-number="19"></td>        <td id="file-upload-html-LC19" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">&lt;!--</span> Parameters for the Tinify API<span class="pl-c">--&gt;</span></span></td>      </tr>      <tr>        <td id="file-upload-html-L20" class="blob-num js-line-number" data-line-number="20"></td>        <td id="file-upload-html-LC20" class="blob-code blob-code-inner js-file-line">        &lt;<span class="pl-ent">div</span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L21" class="blob-num js-line-number" data-line-number="21"></td>        <td id="file-upload-html-LC21" class="blob-code blob-code-inner js-file-line">            &lt;<span class="pl-ent">label</span>&gt;Width&lt;/<span class="pl-ent">label</span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L22" class="blob-num js-line-number" data-line-number="22"></td>        <td id="file-upload-html-LC22" class="blob-code blob-code-inner js-file-line">            &lt;<span class="pl-ent">input</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>number<span class="pl-pds">&quot;</span></span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>width<span class="pl-pds">&quot;</span></span> <span class="pl-e">ng-model</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>ulData.wd<span class="pl-pds">&quot;</span></span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L23" class="blob-num js-line-number" data-line-number="23"></td>        <td id="file-upload-html-LC23" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-upload-html-L24" class="blob-num js-line-number" data-line-number="24"></td>        <td id="file-upload-html-LC24" class="blob-code blob-code-inner js-file-line">            &lt;<span class="pl-ent">label</span>&gt;Height&lt;/<span class="pl-ent">label</span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L25" class="blob-num js-line-number" data-line-number="25"></td>        <td id="file-upload-html-LC25" class="blob-code blob-code-inner js-file-line">            &lt;<span class="pl-ent">input</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>number<span class="pl-pds">&quot;</span></span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>height<span class="pl-pds">&quot;</span></span> <span class="pl-e">ng-model</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>ulData.ht<span class="pl-pds">&quot;</span></span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L26" class="blob-num js-line-number" data-line-number="26"></td>        <td id="file-upload-html-LC26" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-upload-html-L27" class="blob-num js-line-number" data-line-number="27"></td>        <td id="file-upload-html-LC27" class="blob-code blob-code-inner js-file-line">            &lt;<span class="pl-ent">label</span>&gt;Method&lt;/<span class="pl-ent">label</span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L28" class="blob-num js-line-number" data-line-number="28"></td>        <td id="file-upload-html-LC28" class="blob-code blob-code-inner js-file-line">            &lt;<span class="pl-ent">select</span> <span class="pl-e">ng-model</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>ulData.m<span class="pl-pds">&quot;</span></span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L29" class="blob-num js-line-number" data-line-number="29"></td>        <td id="file-upload-html-LC29" class="blob-code blob-code-inner js-file-line">                &lt;<span class="pl-ent">option</span> <span class="pl-e">ng-repeat</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>type in method<span class="pl-pds">&quot;</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>{{type.value}}<span class="pl-pds">&quot;</span></span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L30" class="blob-num js-line-number" data-line-number="30"></td>        <td id="file-upload-html-LC30" class="blob-code blob-code-inner js-file-line">                    {{type.name}}</td>      </tr>      <tr>        <td id="file-upload-html-L31" class="blob-num js-line-number" data-line-number="31"></td>        <td id="file-upload-html-LC31" class="blob-code blob-code-inner js-file-line">                &lt;/<span class="pl-ent">option</span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L32" class="blob-num js-line-number" data-line-number="32"></td>        <td id="file-upload-html-LC32" class="blob-code blob-code-inner js-file-line">            &lt;/<span class="pl-ent">select</span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L33" class="blob-num js-line-number" data-line-number="33"></td>        <td id="file-upload-html-LC33" class="blob-code blob-code-inner js-file-line">        &lt;/<span class="pl-ent">div</span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L34" class="blob-num js-line-number" data-line-number="34"></td>        <td id="file-upload-html-LC34" class="blob-code blob-code-inner js-file-line">        &lt;<span class="pl-ent">button</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>submit<span class="pl-pds">&quot;</span></span> <span class="pl-e">ng-click</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>up.submit()<span class="pl-pds">&quot;</span></span>&gt;Submit&lt;/<span class="pl-ent">button</span>&gt;&lt;<span class="pl-ent">br</span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L35" class="blob-num js-line-number" data-line-number="35"></td>        <td id="file-upload-html-LC35" class="blob-code blob-code-inner js-file-line">        </td>      </tr>      <tr>        <td id="file-upload-html-L36" class="blob-num js-line-number" data-line-number="36"></td>        <td id="file-upload-html-LC36" class="blob-code blob-code-inner js-file-line">        &lt;<span class="pl-ent">a</span> <span class="pl-e">href</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>https://tinypng.com/developers/reference#resizing-images<span class="pl-pds">&quot;</span></span> <span class="pl-e">target</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>_blank<span class="pl-pds">&quot;</span></span>&gt;Method Description&lt;/<span class="pl-ent">a</span>&gt;&lt;<span class="pl-ent">br</span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L37" class="blob-num js-line-number" data-line-number="37"></td>        <td id="file-upload-html-LC37" class="blob-code blob-code-inner js-file-line">        &lt;<span class="pl-ent">img</span> <span class="pl-e">ng-if</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>up.file!=null<span class="pl-pds">&quot;</span></span> <span class="pl-e">ngf-thumbnail</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>up.file || &#39;/thumb.jpg&#39;<span class="pl-pds">&quot;</span></span>/&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L38" class="blob-num js-line-number" data-line-number="38"></td>        <td id="file-upload-html-LC38" class="blob-code blob-code-inner js-file-line">    &lt;/<span class="pl-ent">form</span>&gt;</td>      </tr>      <tr>        <td id="file-upload-html-L39" class="blob-num js-line-number" data-line-number="39"></td>        <td id="file-upload-html-LC39" class="blob-code blob-code-inner js-file-line">&lt;/<span class="pl-ent">div</span>&gt;</td>      </tr></table>  </div>  </div>  </div>      </div>      <div class="gist-meta">        <a href="https://gist.github.com/yjimk/3e3f3cb1dd060fc8f8f68183dfd79f39/raw/428767597f0b5b7945361a00877578697313e544/upload.html" style="float:right">view raw</a>        <a href="https://gist.github.com/yjimk/3e3f3cb1dd060fc8f8f68183dfd79f39#file-upload-html">upload.html</a>        hosted with &#10084; by <a href="https://github.com">GitHub</a>      </div>    </div></div>

Next step is to set up our controller to handle our model and file upload

`public/js/controller/upload-controller.js`

<div id="gist33685686" class="gist">    <div class="gist-file">      <div class="gist-data">        <div class="js-gist-file-update-container js-task-list-container file-box">  <div id="file-upload-controller-js" class="file">      <div itemprop="text" class="blob-wrapper data type-javascript">      <table class="highlight tab-size js-file-line-container" data-tab-size="8">      <tr>        <td id="file-upload-controller-js-L1" class="blob-num js-line-number" data-line-number="1"></td>        <td id="file-upload-controller-js-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">angular</span>.<span class="pl-en">module</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>angular-tinify-s3<span class="pl-pds">&#39;</span></span>).<span class="pl-en">controller</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>uploadCtrl<span class="pl-pds">&#39;</span></span>,[<span class="pl-s"><span class="pl-pds">&#39;</span>$scope<span class="pl-pds">&#39;</span></span>, <span class="pl-s"><span class="pl-pds">&#39;</span>$window<span class="pl-pds">&#39;</span></span>, <span class="pl-s"><span class="pl-pds">&#39;</span>Upload<span class="pl-pds">&#39;</span></span>, </td>      </tr>      <tr>        <td id="file-upload-controller-js-L2" class="blob-num js-line-number" data-line-number="2"></td>        <td id="file-upload-controller-js-LC2" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">function</span>(<span class="pl-smi">$scope</span>, <span class="pl-smi">$window</span>, <span class="pl-smi">Upload</span>){</td>      </tr>      <tr>        <td id="file-upload-controller-js-L3" class="blob-num js-line-number" data-line-number="3"></td>        <td id="file-upload-controller-js-LC3" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-upload-controller-js-L4" class="blob-num js-line-number" data-line-number="4"></td>        <td id="file-upload-controller-js-LC4" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">//</span> Set some model defaults for the Tinify API Parameters</span></td>      </tr>      <tr>        <td id="file-upload-controller-js-L5" class="blob-num js-line-number" data-line-number="5"></td>        <td id="file-upload-controller-js-LC5" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">$scope</span>.<span class="pl-smi">ulData</span><span class="pl-k">=</span>{};</td>      </tr>      <tr>        <td id="file-upload-controller-js-L6" class="blob-num js-line-number" data-line-number="6"></td>        <td id="file-upload-controller-js-LC6" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">$scope</span>.<span class="pl-smi">ulData</span>.<span class="pl-smi">ht</span><span class="pl-k">=</span><span class="pl-c1">150</span>;</td>      </tr>      <tr>        <td id="file-upload-controller-js-L7" class="blob-num js-line-number" data-line-number="7"></td>        <td id="file-upload-controller-js-LC7" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">$scope</span>.<span class="pl-smi">ulData</span>.<span class="pl-smi">wd</span><span class="pl-k">=</span><span class="pl-c1">150</span>;</td>      </tr>      <tr>        <td id="file-upload-controller-js-L8" class="blob-num js-line-number" data-line-number="8"></td>        <td id="file-upload-controller-js-LC8" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">$scope</span>.<span class="pl-smi">ulData</span>.<span class="pl-smi">m</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">&#39;</span>fit<span class="pl-pds">&#39;</span></span>;</td>      </tr>      <tr>        <td id="file-upload-controller-js-L9" class="blob-num js-line-number" data-line-number="9"></td>        <td id="file-upload-controller-js-LC9" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-upload-controller-js-L10" class="blob-num js-line-number" data-line-number="10"></td>        <td id="file-upload-controller-js-LC10" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">//</span> Resize methods accepted (for the select box options)</span></td>      </tr>      <tr>        <td id="file-upload-controller-js-L11" class="blob-num js-line-number" data-line-number="11"></td>        <td id="file-upload-controller-js-LC11" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">$scope</span>.<span class="pl-c1">method</span> <span class="pl-k">=</span> [</td>      </tr>      <tr>        <td id="file-upload-controller-js-L12" class="blob-num js-line-number" data-line-number="12"></td>        <td id="file-upload-controller-js-LC12" class="blob-code blob-code-inner js-file-line">            { value<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&#39;</span>scale<span class="pl-pds">&#39;</span></span>, name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&#39;</span>Scale<span class="pl-pds">&#39;</span></span> },</td>      </tr>      <tr>        <td id="file-upload-controller-js-L13" class="blob-num js-line-number" data-line-number="13"></td>        <td id="file-upload-controller-js-LC13" class="blob-code blob-code-inner js-file-line">            { value<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&#39;</span>fit<span class="pl-pds">&#39;</span></span>, name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&#39;</span>Fit<span class="pl-pds">&#39;</span></span> },</td>      </tr>      <tr>        <td id="file-upload-controller-js-L14" class="blob-num js-line-number" data-line-number="14"></td>        <td id="file-upload-controller-js-LC14" class="blob-code blob-code-inner js-file-line">            { value<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&#39;</span>cover<span class="pl-pds">&#39;</span></span>, name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&#39;</span>Cover<span class="pl-pds">&#39;</span></span> }</td>      </tr>      <tr>        <td id="file-upload-controller-js-L15" class="blob-num js-line-number" data-line-number="15"></td>        <td id="file-upload-controller-js-LC15" class="blob-code blob-code-inner js-file-line">        ];</td>      </tr>      <tr>        <td id="file-upload-controller-js-L16" class="blob-num js-line-number" data-line-number="16"></td>        <td id="file-upload-controller-js-LC16" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-upload-controller-js-L17" class="blob-num js-line-number" data-line-number="17"></td>        <td id="file-upload-controller-js-LC17" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">//</span>Angular File Upload functions</span></td>      </tr>      <tr>        <td id="file-upload-controller-js-L18" class="blob-num js-line-number" data-line-number="18"></td>        <td id="file-upload-controller-js-LC18" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">var</span> vm <span class="pl-k">=</span> <span class="pl-c1">this</span>;</td>      </tr>      <tr>        <td id="file-upload-controller-js-L19" class="blob-num js-line-number" data-line-number="19"></td>        <td id="file-upload-controller-js-LC19" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">vm</span>.<span class="pl-en">submit</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(){</td>      </tr>      <tr>        <td id="file-upload-controller-js-L20" class="blob-num js-line-number" data-line-number="20"></td>        <td id="file-upload-controller-js-LC20" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">if</span> (<span class="pl-smi">vm</span>.<span class="pl-smi">upload_form</span>.<span class="pl-smi">file</span>.<span class="pl-smi">$valid</span> <span class="pl-k">&amp;&amp;</span> <span class="pl-smi">vm</span>.<span class="pl-smi">file</span>) {</td>      </tr>      <tr>        <td id="file-upload-controller-js-L21" class="blob-num js-line-number" data-line-number="21"></td>        <td id="file-upload-controller-js-LC21" class="blob-code blob-code-inner js-file-line">                <span class="pl-smi">vm</span>.<span class="pl-en">upload</span>(<span class="pl-smi">vm</span>.<span class="pl-smi">file</span>, <span class="pl-smi">$scope</span>.<span class="pl-smi">ulData</span>);</td>      </tr>      <tr>        <td id="file-upload-controller-js-L22" class="blob-num js-line-number" data-line-number="22"></td>        <td id="file-upload-controller-js-LC22" class="blob-code blob-code-inner js-file-line">            }</td>      </tr>      <tr>        <td id="file-upload-controller-js-L23" class="blob-num js-line-number" data-line-number="23"></td>        <td id="file-upload-controller-js-LC23" class="blob-code blob-code-inner js-file-line">        };</td>      </tr>      <tr>        <td id="file-upload-controller-js-L24" class="blob-num js-line-number" data-line-number="24"></td>        <td id="file-upload-controller-js-LC24" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-upload-controller-js-L25" class="blob-num js-line-number" data-line-number="25"></td>        <td id="file-upload-controller-js-LC25" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">vm</span>.<span class="pl-en">upload</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">file</span>, <span class="pl-smi">ulData</span>) {</td>      </tr>      <tr>        <td id="file-upload-controller-js-L26" class="blob-num js-line-number" data-line-number="26"></td>        <td id="file-upload-controller-js-LC26" class="blob-code blob-code-inner js-file-line">            <span class="pl-smi">Upload</span>.<span class="pl-en">upload</span>({</td>      </tr>      <tr>        <td id="file-upload-controller-js-L27" class="blob-num js-line-number" data-line-number="27"></td>        <td id="file-upload-controller-js-LC27" class="blob-code blob-code-inner js-file-line">                url<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&#39;</span>/api/upload<span class="pl-pds">&#39;</span></span>,</td>      </tr>      <tr>        <td id="file-upload-controller-js-L28" class="blob-num js-line-number" data-line-number="28"></td>        <td id="file-upload-controller-js-LC28" class="blob-code blob-code-inner js-file-line">                data<span class="pl-k">:</span>{</td>      </tr>      <tr>        <td id="file-upload-controller-js-L29" class="blob-num js-line-number" data-line-number="29"></td>        <td id="file-upload-controller-js-LC29" class="blob-code blob-code-inner js-file-line">                    file<span class="pl-k">:</span>file,</td>      </tr>      <tr>        <td id="file-upload-controller-js-L30" class="blob-num js-line-number" data-line-number="30"></td>        <td id="file-upload-controller-js-LC30" class="blob-code blob-code-inner js-file-line">                    ulData<span class="pl-k">:</span>ulData</td>      </tr>      <tr>        <td id="file-upload-controller-js-L31" class="blob-num js-line-number" data-line-number="31"></td>        <td id="file-upload-controller-js-LC31" class="blob-code blob-code-inner js-file-line">                }</td>      </tr>      <tr>        <td id="file-upload-controller-js-L32" class="blob-num js-line-number" data-line-number="32"></td>        <td id="file-upload-controller-js-LC32" class="blob-code blob-code-inner js-file-line">            }).<span class="pl-en">then</span>(<span class="pl-k">function</span>() {</td>      </tr>      <tr>        <td id="file-upload-controller-js-L33" class="blob-num js-line-number" data-line-number="33"></td>        <td id="file-upload-controller-js-LC33" class="blob-code blob-code-inner js-file-line">                <span class="pl-en">alert</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>Upload Complete!<span class="pl-pds">&#39;</span></span>);</td>      </tr>      <tr>        <td id="file-upload-controller-js-L34" class="blob-num js-line-number" data-line-number="34"></td>        <td id="file-upload-controller-js-LC34" class="blob-code blob-code-inner js-file-line">            });</td>      </tr>      <tr>        <td id="file-upload-controller-js-L35" class="blob-num js-line-number" data-line-number="35"></td>        <td id="file-upload-controller-js-LC35" class="blob-code blob-code-inner js-file-line">        };</td>      </tr>      <tr>        <td id="file-upload-controller-js-L36" class="blob-num js-line-number" data-line-number="36"></td>        <td id="file-upload-controller-js-LC36" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-upload-controller-js-L37" class="blob-num js-line-number" data-line-number="37"></td>        <td id="file-upload-controller-js-LC37" class="blob-code blob-code-inner js-file-line">}]);</td>      </tr></table>  </div>  </div>  </div>      </div>      <div class="gist-meta">        <a href="https://gist.github.com/yjimk/4e7e0bb2b54ec284f4e97d0a75755391/raw/9971b21ecc514fdc0a3686905c2d84b3edb31bc6/upload-controller.js" style="float:right">view raw</a>        <a href="https://gist.github.com/yjimk/4e7e0bb2b54ec284f4e97d0a75755391#file-upload-controller-js">upload-controller.js</a>        hosted with &#10084; by <a href="https://github.com">GitHub</a>      </div>    </div></div>

Righto! That’s our front-end all said and done. If only it were that easy in production! Might want to add a little bit of style to the above, but I’ll leave that up to you.
Finally, to the back-end! This is where the rubber meets the road. We’ll hit the endpoint, save to the local filesystem, resize and optimize with Tinify and then push it straight up to Amazon S3. Cool!
Here’s the finished product, after which I’ll go through step by step.

#### What is Multer anyway?
Multer is Express middleware for handling files in the filesystem. It’s pretty a pretty complicated piece of software, but is quite flexible and extensible to a number of use cases. Just like I did with Angular File Upload, I’m only going to touch on Multer specific to our use case, but would recommend checking out their documentation to see what else you can do with it. For instance if you didn’t want to save to the filesystem before sending it off to Tinify/S3, Multer can be configured to save to memory first instead.

1. Accept cross origin requests

<div id="gist33686466" class="gist">    <div class="gist-file">      <div class="gist-data">        <div class="js-gist-file-update-container js-task-list-container file-box">  <div id="file-routes-js" class="file">      <div itemprop="text" class="blob-wrapper data type-javascript">      <table class="highlight tab-size js-file-line-container" data-tab-size="8">      <tr>        <td id="file-routes-js-L1" class="blob-num js-line-number" data-line-number="1"></td>        <td id="file-routes-js-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-k">function</span>(<span class="pl-smi">req</span>, <span class="pl-smi">res</span>, <span class="pl-smi">next</span>) {</td>      </tr>      <tr>        <td id="file-routes-js-L2" class="blob-num js-line-number" data-line-number="2"></td>        <td id="file-routes-js-LC2" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">res</span>.<span class="pl-en">header</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>Access-Control-Allow-Origin<span class="pl-pds">&quot;</span></span>, <span class="pl-s"><span class="pl-pds">&quot;</span>http://localhost<span class="pl-pds">&quot;</span></span>);</td>      </tr>      <tr>        <td id="file-routes-js-L3" class="blob-num js-line-number" data-line-number="3"></td>        <td id="file-routes-js-LC3" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">res</span>.<span class="pl-en">header</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>Access-Control-Allow-Headers<span class="pl-pds">&quot;</span></span>, <span class="pl-s"><span class="pl-pds">&quot;</span>Origin, X-Requested-With, Content-Type, Accept<span class="pl-pds">&quot;</span></span>);</td>      </tr>      <tr>        <td id="file-routes-js-L4" class="blob-num js-line-number" data-line-number="4"></td>        <td id="file-routes-js-LC4" class="blob-code blob-code-inner js-file-line">    <span class="pl-en">next</span>();</td>      </tr>      <tr>        <td id="file-routes-js-L5" class="blob-num js-line-number" data-line-number="5"></td>        <td id="file-routes-js-LC5" class="blob-code blob-code-inner js-file-line">});</td>      </tr></table>  </div>  </div>  </div>      </div>      <div class="gist-meta">        <a href="https://gist.github.com/yjimk/9014724aba7bbc5231feada057c83aa1/raw/5f751d28ad229f6f01d1ba2f57a92a3bcef5106f/routes.js" style="float:right">view raw</a>        <a href="https://gist.github.com/yjimk/9014724aba7bbc5231feada057c83aa1#file-routes-js">routes.js</a>        hosted with &#10084; by <a href="https://github.com">GitHub</a>      </div>    </div></div>

2. Configure Multer disk storage settings. We’ll be taking the set filename and adding a timestamp in order to prevent any duplication and saving to the directory `/app/uploads/`. We didn’t create that directory earlier, so we should do that now.

```bash
cd app
mkdir uploads
```

Windows/Mac should be fine, but if you’re using Linux, permissions may need to be set using chmod. Probably best to also create a .gitignore inside the uploads so the images aren’t committed to source control.

`/app/uploads/.gitignore`
```git
*
!.gitignore```

Here's the snippet

<div id="gist33686373" class="gist">    <div class="gist-file">      <div class="gist-data">        <div class="js-gist-file-update-container js-task-list-container file-box">  <div id="file-routes-js" class="file">      <div itemprop="text" class="blob-wrapper data type-javascript">      <table class="highlight tab-size js-file-line-container" data-tab-size="8">      <tr>        <td id="file-routes-js-L1" class="blob-num js-line-number" data-line-number="1"></td>        <td id="file-routes-js-LC1" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">var</span> storage <span class="pl-k">=</span> <span class="pl-smi">multer</span>.<span class="pl-en">diskStorage</span>({ <span class="pl-c"><span class="pl-c">//</span>multers disk storage settings</span></td>      </tr>      <tr>        <td id="file-routes-js-L2" class="blob-num js-line-number" data-line-number="2"></td>        <td id="file-routes-js-LC2" class="blob-code blob-code-inner js-file-line">        <span class="pl-en">destination</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">file</span>, <span class="pl-smi">cb</span>) {</td>      </tr>      <tr>        <td id="file-routes-js-L3" class="blob-num js-line-number" data-line-number="3"></td>        <td id="file-routes-js-LC3" class="blob-code blob-code-inner js-file-line">            <span class="pl-en">cb</span>(<span class="pl-c1">null</span>, <span class="pl-s"><span class="pl-pds">&#39;</span>./app/uploads/<span class="pl-pds">&#39;</span></span>)</td>      </tr>      <tr>        <td id="file-routes-js-L4" class="blob-num js-line-number" data-line-number="4"></td>        <td id="file-routes-js-LC4" class="blob-code blob-code-inner js-file-line">        },</td>      </tr>      <tr>        <td id="file-routes-js-L5" class="blob-num js-line-number" data-line-number="5"></td>        <td id="file-routes-js-LC5" class="blob-code blob-code-inner js-file-line">        <span class="pl-en">filename</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">file</span>, <span class="pl-smi">cb</span>) {</td>      </tr>      <tr>        <td id="file-routes-js-L6" class="blob-num js-line-number" data-line-number="6"></td>        <td id="file-routes-js-LC6" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">var</span> datetimestamp <span class="pl-k">=</span> <span class="pl-c1">Date</span>.<span class="pl-en">now</span>();</td>      </tr>      <tr>        <td id="file-routes-js-L7" class="blob-num js-line-number" data-line-number="7"></td>        <td id="file-routes-js-LC7" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">var</span> originalname <span class="pl-k">=</span> <span class="pl-smi">file</span>.<span class="pl-smi">originalname</span>.<span class="pl-c1">split</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>.<span class="pl-pds">&#39;</span></span>);</td>      </tr>      <tr>        <td id="file-routes-js-L8" class="blob-num js-line-number" data-line-number="8"></td>        <td id="file-routes-js-LC8" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">var</span> new_filename <span class="pl-k">=</span> originalname[<span class="pl-c1">0</span>] <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&#39;</span>-<span class="pl-pds">&#39;</span></span> <span class="pl-k">+</span> datetimestamp <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&#39;</span>.<span class="pl-pds">&#39;</span></span> <span class="pl-k">+</span> originalname[<span class="pl-c1">1</span>];</td>      </tr>      <tr>        <td id="file-routes-js-L9" class="blob-num js-line-number" data-line-number="9"></td>        <td id="file-routes-js-LC9" class="blob-code blob-code-inner js-file-line">            <span class="pl-en">cb</span>(<span class="pl-c1">null</span>, new_filename)</td>      </tr>      <tr>        <td id="file-routes-js-L10" class="blob-num js-line-number" data-line-number="10"></td>        <td id="file-routes-js-LC10" class="blob-code blob-code-inner js-file-line">        }</td>      </tr>      <tr>        <td id="file-routes-js-L11" class="blob-num js-line-number" data-line-number="11"></td>        <td id="file-routes-js-LC11" class="blob-code blob-code-inner js-file-line">    });</td>      </tr>      <tr>        <td id="file-routes-js-L12" class="blob-num js-line-number" data-line-number="12"></td>        <td id="file-routes-js-LC12" class="blob-code blob-code-inner js-file-line">    </td>      </tr>      <tr>        <td id="file-routes-js-L13" class="blob-num js-line-number" data-line-number="13"></td>        <td id="file-routes-js-LC13" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">var</span> upload <span class="pl-k">=</span> <span class="pl-en">multer</span>({ <span class="pl-c"><span class="pl-c">//</span>multer settings</span></td>      </tr>      <tr>        <td id="file-routes-js-L14" class="blob-num js-line-number" data-line-number="14"></td>        <td id="file-routes-js-LC14" class="blob-code blob-code-inner js-file-line">        storage<span class="pl-k">:</span> storage</td>      </tr>      <tr>        <td id="file-routes-js-L15" class="blob-num js-line-number" data-line-number="15"></td>        <td id="file-routes-js-LC15" class="blob-code blob-code-inner js-file-line">    }).<span class="pl-en">single</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>file<span class="pl-pds">&#39;</span></span>);</td>      </tr></table>  </div>  </div>  </div>      </div>      <div class="gist-meta">        <a href="https://gist.github.com/yjimk/3505ab7ee5b2ea46f62c1ae8ce54a416/raw/ccad47e5334b0debdea51615b1b21276c868f35d/routes.js" style="float:right">view raw</a>        <a href="https://gist.github.com/yjimk/3505ab7ee5b2ea46f62c1ae8ce54a416#file-routes-js">routes.js</a>        hosted with &#10084; by <a href="https://github.com">GitHub</a>      </div>    </div></div>

Part 3
Our final step! These are our instructions for when our endpoint is hit by Angular File Upload.

<div id="gist33686830" class="gist">    <div class="gist-file">      <div class="gist-data">        <div class="js-gist-file-update-container js-task-list-container file-box">  <div id="file-routes-js" class="file">      <div itemprop="text" class="blob-wrapper data type-javascript">      <table class="highlight tab-size js-file-line-container" data-tab-size="8">      <tr>        <td id="file-routes-js-L1" class="blob-num js-line-number" data-line-number="1"></td>        <td id="file-routes-js-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span>////////// Tinify API Actions ////////////</span></td>      </tr>      <tr>        <td id="file-routes-js-L2" class="blob-num js-line-number" data-line-number="2"></td>        <td id="file-routes-js-LC2" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">app</span>.<span class="pl-en">post</span>(<span class="pl-s"><span class="pl-pds">&#39;</span>/api/upload<span class="pl-pds">&#39;</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">res</span>) {</td>      </tr>      <tr>        <td id="file-routes-js-L3" class="blob-num js-line-number" data-line-number="3"></td>        <td id="file-routes-js-LC3" class="blob-code blob-code-inner js-file-line">        <span class="pl-en">upload</span>(req,res,<span class="pl-k">function</span>(<span class="pl-smi">err</span>){</td>      </tr>      <tr>        <td id="file-routes-js-L4" class="blob-num js-line-number" data-line-number="4"></td>        <td id="file-routes-js-LC4" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"><span class="pl-c">//</span>Simple error handling</span></td>      </tr>      <tr>        <td id="file-routes-js-L5" class="blob-num js-line-number" data-line-number="5"></td>        <td id="file-routes-js-LC5" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">if</span>(err){</td>      </tr>      <tr>        <td id="file-routes-js-L6" class="blob-num js-line-number" data-line-number="6"></td>        <td id="file-routes-js-LC6" class="blob-code blob-code-inner js-file-line">                <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);</td>      </tr>      <tr>        <td id="file-routes-js-L7" class="blob-num js-line-number" data-line-number="7"></td>        <td id="file-routes-js-LC7" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">return</span>;</td>      </tr>      <tr>        <td id="file-routes-js-L8" class="blob-num js-line-number" data-line-number="8"></td>        <td id="file-routes-js-LC8" class="blob-code blob-code-inner js-file-line">            }</td>      </tr>      <tr>        <td id="file-routes-js-L9" class="blob-num js-line-number" data-line-number="9"></td>        <td id="file-routes-js-LC9" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"><span class="pl-c">//</span>Even though I&#39;m sending height and width as a number on the front end, I found that it was giving me a string. </span></td>      </tr>      <tr>        <td id="file-routes-js-L10" class="blob-num js-line-number" data-line-number="10"></td>        <td id="file-routes-js-LC10" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"><span class="pl-c">//</span>This may be by design, but I need it back as a number for the Tinify API</span></td>      </tr>      <tr>        <td id="file-routes-js-L11" class="blob-num js-line-number" data-line-number="11"></td>        <td id="file-routes-js-LC11" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">var</span> height <span class="pl-k">=</span> <span class="pl-c1">parseInt</span>(<span class="pl-smi">req</span>.<span class="pl-c1">body</span>.<span class="pl-smi">ulData</span>.<span class="pl-smi">ht</span>);</td>      </tr>      <tr>        <td id="file-routes-js-L12" class="blob-num js-line-number" data-line-number="12"></td>        <td id="file-routes-js-LC12" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">var</span> width <span class="pl-k">=</span> <span class="pl-c1">parseInt</span>(<span class="pl-smi">req</span>.<span class="pl-c1">body</span>.<span class="pl-smi">ulData</span>.<span class="pl-smi">wd</span>);</td>      </tr>      <tr>        <td id="file-routes-js-L13" class="blob-num js-line-number" data-line-number="13"></td>        <td id="file-routes-js-LC13" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">var</span> method <span class="pl-k">=</span> <span class="pl-smi">req</span>.<span class="pl-c1">body</span>.<span class="pl-smi">ulData</span>.<span class="pl-smi">m</span>;</td>      </tr>      <tr>        <td id="file-routes-js-L14" class="blob-num js-line-number" data-line-number="14"></td>        <td id="file-routes-js-LC14" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-routes-js-L15" class="blob-num js-line-number" data-line-number="15"></td>        <td id="file-routes-js-LC15" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">var</span> resizeMethod <span class="pl-k">=</span> {};</td>      </tr>      <tr>        <td id="file-routes-js-L16" class="blob-num js-line-number" data-line-number="16"></td>        <td id="file-routes-js-LC16" class="blob-code blob-code-inner js-file-line">            <span class="pl-smi">resizeMethod</span>.<span class="pl-c1">method</span> <span class="pl-k">=</span> method;</td>      </tr>      <tr>        <td id="file-routes-js-L17" class="blob-num js-line-number" data-line-number="17"></td>        <td id="file-routes-js-LC17" class="blob-code blob-code-inner js-file-line">            </td>      </tr>      <tr>        <td id="file-routes-js-L18" class="blob-num js-line-number" data-line-number="18"></td>        <td id="file-routes-js-LC18" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"><span class="pl-c">//</span>If the method is &#39;scale&#39;, either height or width needs to be omitted or an error will result</span></td>      </tr>      <tr>        <td id="file-routes-js-L19" class="blob-num js-line-number" data-line-number="19"></td>        <td id="file-routes-js-LC19" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">if</span> (method <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">&#39;</span>scale<span class="pl-pds">&#39;</span></span>)</td>      </tr>      <tr>        <td id="file-routes-js-L20" class="blob-num js-line-number" data-line-number="20"></td>        <td id="file-routes-js-LC20" class="blob-code blob-code-inner js-file-line">            {</td>      </tr>      <tr>        <td id="file-routes-js-L21" class="blob-num js-line-number" data-line-number="21"></td>        <td id="file-routes-js-LC21" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">if</span> (height <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>)</td>      </tr>      <tr>        <td id="file-routes-js-L22" class="blob-num js-line-number" data-line-number="22"></td>        <td id="file-routes-js-LC22" class="blob-code blob-code-inner js-file-line">                {</td>      </tr>      <tr>        <td id="file-routes-js-L23" class="blob-num js-line-number" data-line-number="23"></td>        <td id="file-routes-js-LC23" class="blob-code blob-code-inner js-file-line">                    <span class="pl-smi">resizeMethod</span>.<span class="pl-c1">height</span> <span class="pl-k">=</span> height;</td>      </tr>      <tr>        <td id="file-routes-js-L24" class="blob-num js-line-number" data-line-number="24"></td>        <td id="file-routes-js-LC24" class="blob-code blob-code-inner js-file-line">                }</td>      </tr>      <tr>        <td id="file-routes-js-L25" class="blob-num js-line-number" data-line-number="25"></td>        <td id="file-routes-js-LC25" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">else</span></td>      </tr>      <tr>        <td id="file-routes-js-L26" class="blob-num js-line-number" data-line-number="26"></td>        <td id="file-routes-js-LC26" class="blob-code blob-code-inner js-file-line">                {</td>      </tr>      <tr>        <td id="file-routes-js-L27" class="blob-num js-line-number" data-line-number="27"></td>        <td id="file-routes-js-LC27" class="blob-code blob-code-inner js-file-line">                    <span class="pl-smi">resizeMethod</span>.<span class="pl-c1">width</span> <span class="pl-k">=</span> width;</td>      </tr>      <tr>        <td id="file-routes-js-L28" class="blob-num js-line-number" data-line-number="28"></td>        <td id="file-routes-js-LC28" class="blob-code blob-code-inner js-file-line">                }</td>      </tr>      <tr>        <td id="file-routes-js-L29" class="blob-num js-line-number" data-line-number="29"></td>        <td id="file-routes-js-LC29" class="blob-code blob-code-inner js-file-line">            }</td>      </tr>      <tr>        <td id="file-routes-js-L30" class="blob-num js-line-number" data-line-number="30"></td>        <td id="file-routes-js-LC30" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">else</span></td>      </tr>      <tr>        <td id="file-routes-js-L31" class="blob-num js-line-number" data-line-number="31"></td>        <td id="file-routes-js-LC31" class="blob-code blob-code-inner js-file-line">            {</td>      </tr>      <tr>        <td id="file-routes-js-L32" class="blob-num js-line-number" data-line-number="32"></td>        <td id="file-routes-js-LC32" class="blob-code blob-code-inner js-file-line">                <span class="pl-smi">resizeMethod</span>.<span class="pl-c1">width</span> <span class="pl-k">=</span> width;</td>      </tr>      <tr>        <td id="file-routes-js-L33" class="blob-num js-line-number" data-line-number="33"></td>        <td id="file-routes-js-LC33" class="blob-code blob-code-inner js-file-line">                <span class="pl-smi">resizeMethod</span>.<span class="pl-c1">height</span> <span class="pl-k">=</span> height;</td>      </tr>      <tr>        <td id="file-routes-js-L34" class="blob-num js-line-number" data-line-number="34"></td>        <td id="file-routes-js-LC34" class="blob-code blob-code-inner js-file-line">            }</td>      </tr>      <tr>        <td id="file-routes-js-L35" class="blob-num js-line-number" data-line-number="35"></td>        <td id="file-routes-js-LC35" class="blob-code blob-code-inner js-file-line"></td>      </tr>      <tr>        <td id="file-routes-js-L36" class="blob-num js-line-number" data-line-number="36"></td>        <td id="file-routes-js-LC36" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">var</span> filename <span class="pl-k">=</span> <span class="pl-smi">req</span>.<span class="pl-smi">file</span>.<span class="pl-c1">filename</span>;</td>      </tr>      <tr>        <td id="file-routes-js-L37" class="blob-num js-line-number" data-line-number="37"></td>        <td id="file-routes-js-LC37" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"><span class="pl-c">//</span>Grab the file just saved to disk</span></td>      </tr>      <tr>        <td id="file-routes-js-L38" class="blob-num js-line-number" data-line-number="38"></td>        <td id="file-routes-js-LC38" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">var</span> source <span class="pl-k">=</span> <span class="pl-smi">tinify</span>.<span class="pl-en">fromFile</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>./app/uploads/<span class="pl-pds">&quot;</span></span> <span class="pl-k">+</span> filename);</td>      </tr>      <tr>        <td id="file-routes-js-L39" class="blob-num js-line-number" data-line-number="39"></td>        <td id="file-routes-js-LC39" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"><span class="pl-c">//</span>Resize the image using Tinify!</span></td>      </tr>      <tr>        <td id="file-routes-js-L40" class="blob-num js-line-number" data-line-number="40"></td>        <td id="file-routes-js-LC40" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">var</span> resized <span class="pl-k">=</span> <span class="pl-smi">source</span>.<span class="pl-c1">resize</span>(resizeMethod);</td>      </tr>      <tr>        <td id="file-routes-js-L41" class="blob-num js-line-number" data-line-number="41"></td>        <td id="file-routes-js-LC41" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"><span class="pl-c">//</span>Send the resized image straight up to Amazon S3</span></td>      </tr>      <tr>        <td id="file-routes-js-L42" class="blob-num js-line-number" data-line-number="42"></td>        <td id="file-routes-js-LC42" class="blob-code blob-code-inner js-file-line">            <span class="pl-smi">resized</span>.<span class="pl-en">store</span>({</td>      </tr>      <tr>        <td id="file-routes-js-L43" class="blob-num js-line-number" data-line-number="43"></td>        <td id="file-routes-js-LC43" class="blob-code blob-code-inner js-file-line">                service<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&quot;</span>s3<span class="pl-pds">&quot;</span></span>,</td>      </tr>      <tr>        <td id="file-routes-js-L44" class="blob-num js-line-number" data-line-number="44"></td>        <td id="file-routes-js-LC44" class="blob-code blob-code-inner js-file-line">                aws_access_key_id<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&quot;</span>YOUR_AWS_ACCESS_KEY_ID<span class="pl-pds">&quot;</span></span>,</td>      </tr>      <tr>        <td id="file-routes-js-L45" class="blob-num js-line-number" data-line-number="45"></td>        <td id="file-routes-js-LC45" class="blob-code blob-code-inner js-file-line">                aws_secret_access_key<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&quot;</span>YOUR_AWS_SECRET_ACCESS_KEY<span class="pl-pds">&quot;</span></span>,</td>      </tr>      <tr>        <td id="file-routes-js-L46" class="blob-num js-line-number" data-line-number="46"></td>        <td id="file-routes-js-LC46" class="blob-code blob-code-inner js-file-line">                region<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&quot;</span>your-bucket-region<span class="pl-pds">&quot;</span></span>,</td>      </tr>      <tr>        <td id="file-routes-js-L47" class="blob-num js-line-number" data-line-number="47"></td>        <td id="file-routes-js-LC47" class="blob-code blob-code-inner js-file-line">                path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&quot;</span>your-bucket-name/folder/<span class="pl-pds">&quot;</span></span> <span class="pl-k">+</span> filename</td>      </tr>      <tr>        <td id="file-routes-js-L48" class="blob-num js-line-number" data-line-number="48"></td>        <td id="file-routes-js-LC48" class="blob-code blob-code-inner js-file-line">            });</td>      </tr>      <tr>        <td id="file-routes-js-L49" class="blob-num js-line-number" data-line-number="49"></td>        <td id="file-routes-js-LC49" class="blob-code blob-code-inner js-file-line">        });</td>      </tr>      <tr>        <td id="file-routes-js-L50" class="blob-num js-line-number" data-line-number="50"></td>        <td id="file-routes-js-LC50" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">res</span>.<span class="pl-en">json</span>();</td>      </tr>      <tr>        <td id="file-routes-js-L51" class="blob-num js-line-number" data-line-number="51"></td>        <td id="file-routes-js-LC51" class="blob-code blob-code-inner js-file-line">    });</td>      </tr></table>  </div>  </div>  </div>      </div>      <div class="gist-meta">        <a href="https://gist.github.com/yjimk/1e177c5b90de5893b00197143c7ddcae/raw/4b39b10ccda33886f2612936946cd31d746a89cb/routes.js" style="float:right">view raw</a>        <a href="https://gist.github.com/yjimk/1e177c5b90de5893b00197143c7ddcae#file-routes-js">routes.js</a>        hosted with &#10084; by <a href="https://github.com">GitHub</a>      </div>    </div></div>

Well that was fun! Now you’ll be able to resize, optimize and save to Amazon S3 all with very minimal effort.
Notice something wrong? Feel free to create a pull request on GitHub, or send me an email. I’m more than happy to accept advice and constructive criticism!
